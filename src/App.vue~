<template>
  <nav class="navbar navbar-expand-lg fixed-top">
      <div class="container-fluid">
		<div class="d-inline-block">
			<div v-if="this.$store.state.authenticated">
				<a class="p-2" data-bs-toggle="offcanvas" href="#sidebar" role="button" aria-controls="sidebar" style="margin-right:15px;">
					<i class="bi bi-three-dots"></i>
				</a>
				<router-link to="/dashboard" class="navbar-brand test-start">Wlog</router-link>
			</div>
			<div v-else>
				<router-link to="/login" class="navbar-brand test-start">Wlog</router-link>
			</div>
		</div>
		
		<div v-if="this.$store.state.authenticated">
			<div class="align-items-right">
				<ul class="navbar-nav">
					<li class="nav-item">
						<router-link to="/login" class="nav-link">
							Sign In
						</router-link>
					</li>
					<li class="nav-item">
						<router-link to="/register" class="nav-link">
							Sign Up
						</router-link>
					</li>
				</ul>
			</div>
		</div>
		
		<div v-else>
			<div class="align-items-right">
				<ul class="navbar-nav">
					<li class="nav-item">
						<router-link to="/dashboard" class="nav-link">
							Dashboard
						</router-link>
					</li>
					<li class="nav-item">
						<router-link to="/town-hall" class="nav-link">
							Town Hall
						</router-link>
					</li>
					<li class="nav-item">
						<router-link
							to="#"
							class="nav-link"
							@click="signOut"
							>
							Sign Out
						</router-link>
					</li>
				</ul>
			</div>
		</div>
      </div>
    </nav>
	<div class="offcanvas offcanvas-start" data-bs-scroll="true" tabindex="-1" id="sidebar" aria-labelledby="sidebarLabel">
	  <div class="offcanvas-header">
		<h5 class="offcanvas-title" id="sidebarLabel">Menu</h5>
		<button type="button" class="btn-close text-reset" data-bs-dismiss="offcanvas" aria-label="Close"></button>
	  </div>
	  <hr/>
	  <div class="offcanvas-body">
		<h6 class="card-subtitle">PUBLIC</h6>
		
		<div class="list-group list-group-flush">
		  <a class="list-group-item list-group-item-action town-active" href="#">
			<i class="bi bi-megaphone-fill p-2"></i>Town Hall
		  </a>
		</div>
		
		<h6 class="card-subtitle">COMMUNITY</h6>
		<div class="list-group list-group-flush">
		  <a class="list-group-item list-group-item-action dashboard-active" href="/dashboard">
			<i class="bi bi-tv-fill p-2"></i>Control Room
		  </a>
		  <a class="list-group-item list-group-item-action private-active" href="#">
			<i class="bi bi-unlock-fill p-2"></i>Private Space
		  </a>
		  <a class="list-group-item list-group-item-action community-active" href="#">
			<i class="bi bi-people-fill p-2"></i>Community Space
		  </a>
		</div>
		  
		<h6 class="card-subtitle mt-4">EXTRAS</h6>
		<div class="list-group list-group-flush">
		  <a class="list-group-item list-group-item-action dashboard-active" href="/dashboard">
			<i class="bi bi-wrench p-2"></i>Settings
		  </a>
		</div>
	  </div>
	</div>
  <router-view />
</template>

<script>
import axios from 'axios';

export default {
  data() {
    return {
      showMobileMenu: false,
    }
  },
  beforeCreate(){
	// Check whether user is authenticated before start of every pages
	if(localStorage.getItem('token')){
		this.$store.commit('setAuth', true)
	
		const token = this.$store.state.token
		if(token){
			axios.defaults.headers.common['Authorization'] = 'Bearer ' + token
		}
	}
	
  },
  methods: {
	signOut(){
		// Refresh all credentials
		localStorage.removeItem('token')
		axios.defaults.headers.common['Authorization'] = ''
		
		this.$store.commit('setToken', '')
		this.$store.commit('setAuth', false)
		
		this.$router.push('/login')
	}
  },
}
</script>

<style>
#app {
  font-family: 'Open Sans', sans-serif;
  color: #2c3e50;
}

.navbar {
  box-shadow: 0 1px 5px 1px #cccccc;
  background-color: #fff;
}

.is-success {
	background-color: #48c78e;
	color: #fff;
}

.offcanvas-start {
	/* override sidebar's default width */
	width: 300px !important;
}

html {
	overflow-x: hidden;
}
</style>
